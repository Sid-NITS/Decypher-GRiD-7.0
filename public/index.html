<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeCypher - Online Shopping for Everything</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f1f3f6;
            line-height: 1.6;
            color: #212121;
        }

        /* Header */
        .header {
            background: #2874f0;
            color: white;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        .header-content {
            max-width: 1248px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            padding: 8px 16px;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: white;
            min-width: 140px;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 500;
            font-style: italic;
        }

        .logo-plus {
            font-size: 11px;
            color: #ffe500;
            margin-left: 2px;
        }

        .logo-subtitle {
            font-size: 11px;
            color: white;
            font-style: italic;
            margin-left: 8px;
        }

        /* Search Container */
        .search-container {
            flex: 1;
            max-width: 520px;
            position: relative;
            margin: 0 16px;
        }

        .search-box {
            position: relative;
            display: flex;
        }

        .search-input {
            width: 100%;
            padding: 10px 16px;
            border: none;
            outline: none;
            font-size: 14px;
            border-radius: 2px 0 0 2px;
            background: white;
        }

        .search-button {
            background: #fb641b;
            border: none;
            padding: 0 24px;
            color: white;
            cursor: pointer;
            border-radius: 0 2px 2px 0;
            font-size: 16px;
        }

        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #d4d4d4;
            border-top: none;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            display: none;
            z-index: 1001;
            max-height: 300px;
            overflow-y: auto;
        }

        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: background-color 0.2s;
            color: #212121;
            font-size: 14px;
        }

        .suggestion-item:hover,
        .suggestion-item.active {
            background: #f8f9fa;
            color: #2874f0;
        }

        .suggestion-item:last-child {
            border-bottom: none;
        }

        .suggestion-icon {
            color: #878787;
            width: 16px;
            flex-shrink: 0;
        }

        /* Navigation */
        .nav-links {
            display: flex;
            align-items: center;
            gap: 32px;
            margin-left: auto;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-size: 16px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 0;
        }

        .nav-link:hover {
            opacity: 0.8;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #2874f0 0%, #fb641b 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
        }

        .hero-content {
            max-width: 1248px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .hero h1 {
            font-size: 48px;
            font-weight: 300;
            margin-bottom: 16px;
        }

        .hero p {
            font-size: 20px;
            opacity: 0.9;
            margin-bottom: 32px;
        }

        .hero-search {
            max-width: 600px;
            margin: 0 auto;
            position: relative;
        }

        .hero-search .search-box {
            background: white;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .hero-search .search-input {
            padding: 16px 20px;
            font-size: 16px;
            border-radius: 4px 0 0 4px;
        }

        .hero-search .search-button {
            padding: 0 32px;
            font-size: 18px;
            border-radius: 0 4px 4px 0;
        }

        /* Hero Search Suggestions */
        .hero-search .search-suggestions {
            border-radius: 0 0 4px 4px;
            margin-top: 0;
        }

        /* Categories */
        .categories {
            padding: 40px 0;
            background: white;
        }

        .categories-content {
            max-width: 1248px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 500;
            margin-bottom: 24px;
            color: #212121;
        }

        .categories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 40px;
        }

        .category-card {
            background: white;
            border-radius: 8px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .category-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
        }

        .category-icon {
            font-size: 48px;
            color: #2874f0;
            margin-bottom: 16px;
        }

        .category-name {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 8px;
        }

        .category-count {
            font-size: 14px;
            color: #878787;
        }

        /* Featured Products */
        .featured {
            padding: 40px 0;
            background: #f8f9fa;
        }

        .featured-content {
            max-width: 1248px;
            margin: 0 auto;
            padding: 0 16px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .product-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .product-link {
            text-decoration: none;
            color: inherit;
            display: block;
        }

        .product-image {
            width: 100%;
            height: 200px;
            background: #f5f5f5;
            border-radius: 4px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-image i {
            font-size: 48px;
            color: #e0e0e0;
        }

        .wishlist-icon {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .wishlist-icon:hover {
            background: white;
            transform: scale(1.1);
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .wishlist-icon i {
            font-size: 12px;
            color: #878787;
            transition: color 0.2s ease;
        }

        .wishlist-icon.liked i {
            color: #ff3f6c;
        }

        .product-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            line-height: 1.4;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .product-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .rating-badge {
            background: #388e3c;
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .rating-count {
            font-size: 12px;
            color: #878787;
        }

        .product-price {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .price-current {
            font-size: 16px;
            font-weight: 500;
            color: #212121;
        }

        .price-original {
            font-size: 14px;
            color: #878787;
            text-decoration: line-through;
        }

        .price-discount {
            font-size: 12px;
            color: #388e3c;
            font-weight: 500;
        }

        /* Footer */
        .footer {
            background: #172337;
            color: white;
            padding: 40px 0 20px;
        }

        .footer-content {
            max-width: 1248px;
            margin: 0 auto;
            padding: 0 16px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 32px;
        }

        .footer-section h3 {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 16px;
            color: #878787;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 8px;
        }

        .footer-section ul li a {
            color: white;
            text-decoration: none;
            font-size: 14px;
        }

        .footer-section ul li a:hover {
            text-decoration: underline;
        }

        .footer-bottom {
            border-top: 1px solid #3a3a3a;
            margin-top: 32px;
            padding-top: 20px;
            text-align: center;
            color: #878787;
            font-size: 14px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-wrap: wrap;
                gap: 8px;
            }

            .search-container {
                order: 3;
                flex-basis: 100%;
                margin: 8px 0 0 0;
            }

            .nav-links {
                margin-left: auto;
                gap: 16px;
            }

            .nav-link span {
                display: none;
            }

            .hero h1 {
                font-size: 32px;
            }

            .hero p {
                font-size: 16px;
            }

            .categories-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }

            .footer-content {
                grid-template-columns: 1fr;
                gap: 24px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #2874f0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <span class="logo-text">DeCypher</span>
                <span class="logo-plus">+</span>
                <span class="logo-subtitle">Explore Plus</span>
            </a>

            <div class="search-container">
                <form class="search-box" id="searchForm">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput"
                        placeholder="Search for products, brands and more"
                        autocomplete="off"
                    >
                    <button type="submit" class="search-button">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
                <div class="search-suggestions" id="searchSuggestions"></div>
            </div>

            <nav class="nav-links">
                <a href="#" class="nav-link">
                    <i class="fas fa-user"></i>
                    <span>Login</span>
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-heart"></i>
                    <span>Wishlist</span>
                </a>
                <a href="#" class="nav-link">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Cart</span>
                </a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Discover Amazing Products</h1>
            <p>Search millions of products with intelligent suggestions</p>
            <div class="hero-search">
                <form class="search-box" id="heroSearchForm">
                    <input 
                        type="text" 
                        class="search-input" 
                        id="heroSearchInput"
                        placeholder="What are you looking for today?"
                        autocomplete="off"
                    >
                    <button type="submit" class="search-button">
                        <i class="fas fa-search"></i>
                    </button>
                </form>
                <div class="search-suggestions" id="heroSearchSuggestions"></div>
            </div>
        </div>
    </section>

    <!-- Categories -->
    <section class="categories">
        <div class="categories-content">
            <h2 class="section-title">Shop by Category</h2>
            <div class="categories-grid" id="categoriesGrid">
                <a href="search.html?category=electronics" class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-laptop"></i>
                    </div>
                    <div class="category-name">Electronics</div>
                    <div class="category-count">10,000+ products</div>
                </a>
                <a href="search.html?category=fashion" class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-tshirt"></i>
                    </div>
                    <div class="category-name">Fashion</div>
                    <div class="category-count">25,000+ products</div>
                </a>
                <a href="search.html?category=home" class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="category-name">Home & Kitchen</div>
                    <div class="category-count">15,000+ products</div>
                </a>
                <a href="search.html?category=books" class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="category-name">Books</div>
                    <div class="category-count">8,000+ products</div>
                </a>
                <a href="search.html?category=sports" class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-basketball-ball"></i>
                    </div>
                    <div class="category-name">Sports</div>
                    <div class="category-count">5,000+ products</div>
                </a>
                <a href="search.html?category=beauty" class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-spa"></i>
                    </div>
                    <div class="category-name">Beauty</div>
                    <div class="category-count">12,000+ products</div>
                </a>
            </div>
        </div>
    </section>

    <!-- Featured Products -->
    <section class="featured">
        <div class="featured-content">
            <h2 class="section-title">Featured Products</h2>
            <div class="products-grid" id="featuredProducts">
                <!-- Products will be loaded here -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About</h3>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Press</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Help</h3>
                <ul>
                    <li><a href="#">Payments</a></li>
                    <li><a href="#">Shipping</a></li>
                    <li><a href="#">Cancellation & Returns</a></li>
                    <li><a href="#">FAQ</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Policy</h3>
                <ul>
                    <li><a href="#">Return Policy</a></li>
                    <li><a href="#">Terms of Use</a></li>
                    <li><a href="#">Security</a></li>
                    <li><a href="#">Privacy</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Social</h3>
                <ul>
                    <li><a href="#">Facebook</a></li>
                    <li><a href="#">Twitter</a></li>
                    <li><a href="#">YouTube</a></li>
                    <li><a href="#">Instagram</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 DeCypher. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Search functionality
        let searchTimeout;
        let currentSuggestions = [];
        let activeSuggestionIndex = -1;
        let isSearchFocused = false;

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            // Load data from API first
            await loadDataFromAPI();
            
            setupSearchFunctionality();
            await loadFeaturedProducts();
        });

        function setupSearchFunctionality() {
            const searchInputs = [
                document.getElementById('searchInput'),
                document.getElementById('heroSearchInput')
            ];

            searchInputs.forEach(input => {
                if (input) {
                    input.addEventListener('input', handleSearchInput);
                    input.addEventListener('keyup', handleSearchKeyUp);
                    input.addEventListener('keydown', handleSearchKeydown);
                    input.addEventListener('blur', handleSearchBlur);
                    input.addEventListener('focus', handleSearchFocus);
                }
            });

            // Form submissions
            document.getElementById('searchForm').addEventListener('submit', handleSearchSubmit);
            document.getElementById('heroSearchForm').addEventListener('submit', handleSearchSubmit);
            
            // Click outside to hide suggestions
            document.addEventListener('click', handleDocumentClick);
        }

        function handleSearchFocus(e) {
            const query = e.target.value.trim();
            const isHeroSearch = e.target.id === 'heroSearchInput';
            isSearchFocused = true;
            activeSuggestionIndex = -1;
            
            if (query.length >= 1) {
                fetchSuggestions(query, isHeroSearch);
            }
        }

        function handleSearchBlur(e) {
            // Delay hiding to allow clicking on suggestions
            setTimeout(() => {
                if (!isSearchFocused) {
                    const isHeroSearch = e.target.id === 'heroSearchInput';
                    hideSuggestions(isHeroSearch);
                }
            }, 150);
        }

        function handleSearchKeyUp(e) {
            // Handle immediate hiding of suggestions when input is cleared
            const query = e.target.value.trim();
            const isHeroSearch = e.target.id === 'heroSearchInput';
            
            if (query.length < 1) {
                clearTimeout(searchTimeout);
                hideSuggestions(isHeroSearch);
            }
        }

        function handleDocumentClick(e) {
            const searchContainers = document.querySelectorAll('.search-container, .hero-search');
            let clickedInSearch = false;
            
            searchContainers.forEach(container => {
                if (container.contains(e.target)) {
                    clickedInSearch = true;
                }
            });
            
            if (!clickedInSearch) {
                isSearchFocused = false;
                hideSuggestions(false);
                hideSuggestions(true);
                activeSuggestionIndex = -1;
            }
        }

        function handleSearchInput(e) {
            const query = e.target.value.trim();
            const isHeroSearch = e.target.id === 'heroSearchInput';
            isSearchFocused = true;
            activeSuggestionIndex = -1;
            
            // Clear any pending timeout
            clearTimeout(searchTimeout);
            
            if (query.length < 1) {
                hideSuggestions(isHeroSearch);
                return;
            }

            searchTimeout = setTimeout(() => {
                // Double-check that the input still has content when timeout executes
                const currentQuery = e.target.value.trim();
                if (currentQuery.length >= 1) {
                    fetchSuggestions(currentQuery, isHeroSearch);
                } else {
                    hideSuggestions(isHeroSearch);
                }
            }, 200); // Reduced delay for faster response
        }

        async function fetchSuggestions(query, isHeroSearch = false) {
            // Safety check: if query is empty, hide suggestions instead
            if (!query || query.trim().length < 1) {
                hideSuggestions(isHeroSearch);
                return;
            }
            
            try {
                // Use the actual API endpoint for suggestions
                const response = await fetch(`/api/suggest?q=${encodeURIComponent(query)}&limit=6`);
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                
                // Transform API response to match our suggestion format
                const suggestions = data.map(item => ({
                    text: item.suggestion || item.title || item.name,
                    type: item.type || 'product',
                    category: item.category || 'Product'
                }));
                
                showSuggestions(suggestions, isHeroSearch);
            } catch (error) {
                console.error('Error fetching suggestions:', error);
                // Fallback to demo suggestions if API fails
                showDemoSuggestions(query, isHeroSearch);
            }
        }

        function showDemoSuggestions(query, isHeroSearch = false) {
            const lowerQuery = query.toLowerCase();
            
            // Smart suggestions based on what user is typing
            const smartSuggestions = [];
            
            // Electronics suggestions
            if (lowerQuery.includes('i') || lowerQuery.includes('ip') || lowerQuery.includes('iph') || lowerQuery.includes('phone') || lowerQuery.includes('apple') || lowerQuery.includes('mob')) {
                smartSuggestions.push({ text: 'iPhone 15', type: 'product' });
                smartSuggestions.push({ text: 'iPhone 15 Pro', type: 'product' });
                smartSuggestions.push({ text: 'Mobile phones', type: 'category' });
            }
            if (lowerQuery.includes('sam') || lowerQuery.includes('galaxy') || lowerQuery.includes('mob')) {
                smartSuggestions.push({ text: 'Samsung Galaxy S24', type: 'product' });
                smartSuggestions.push({ text: 'Samsung Galaxy Watch', type: 'product' });
                smartSuggestions.push({ text: 'Samsung mobile', type: 'product' });
            }
            if (lowerQuery.includes('lap') || lowerQuery.includes('dell') || lowerQuery.includes('computer') || lowerQuery.includes('mac')) {
                smartSuggestions.push({ text: 'Dell laptop', type: 'product' });
                smartSuggestions.push({ text: 'MacBook', type: 'product' });
                smartSuggestions.push({ text: 'Gaming laptop', type: 'product' });
            }
            if (lowerQuery.includes('head') || lowerQuery.includes('sony') || lowerQuery.includes('audio') || lowerQuery.includes('music')) {
                smartSuggestions.push({ text: 'Sony headphones', type: 'product' });
                smartSuggestions.push({ text: 'Wireless headphones', type: 'product' });
                smartSuggestions.push({ text: 'Bluetooth headphones', type: 'product' });
            }
            
            // Fashion suggestions
            if (lowerQuery.includes('nik') || lowerQuery.includes('shoe') || lowerQuery.includes('sneak') || lowerQuery.includes('run')) {
                smartSuggestions.push({ text: 'Nike shoes', type: 'product' });
                smartSuggestions.push({ text: 'Running shoes', type: 'product' });
                smartSuggestions.push({ text: 'Sports shoes', type: 'product' });
            }
            if (lowerQuery.includes('adi') || lowerQuery.includes('ultra')) {
                smartSuggestions.push({ text: 'Adidas sneakers', type: 'product' });
                smartSuggestions.push({ text: 'Adidas Ultraboost', type: 'product' });
            }
            if (lowerQuery.includes('jean') || lowerQuery.includes('cloth') || lowerQuery.includes('shirt')) {
                smartSuggestions.push({ text: 'Jeans', type: 'product' });
                smartSuggestions.push({ text: 'T-shirts', type: 'product' });
                smartSuggestions.push({ text: 'Casual wear', type: 'category' });
            }
            
            // Books suggestions
            if (lowerQuery.includes('book') || lowerQuery.includes('psych') || lowerQuery.includes('read')) {
                smartSuggestions.push({ text: 'Psychology books', type: 'product' });
                smartSuggestions.push({ text: 'Best sellers', type: 'category' });
                smartSuggestions.push({ text: 'Fiction books', type: 'category' });
            }
            
            // Mobile specific suggestions
            if (lowerQuery.includes('mob') || lowerQuery.includes('phone') || lowerQuery.includes('smart')) {
                smartSuggestions.push({ text: 'Mobile phones', type: 'category' });
                smartSuggestions.push({ text: 'Smartphones', type: 'category' });
                smartSuggestions.push({ text: 'Mobile accessories', type: 'category' });
            }
            
            // Generic fallbacks if no smart matches
            if (smartSuggestions.length === 0) {
                smartSuggestions.push(
                    { text: `${query} deals`, type: 'category' },
                    { text: `${query} offers`, type: 'category' },
                    { text: `Best ${query}`, type: 'category' }
                );
            }
            
            // Add some popular categories if still less than 6
            if (smartSuggestions.length < 6) {
                smartSuggestions.push(
                    { text: 'Electronics', type: 'category' },
                    { text: 'Fashion', type: 'category' },
                    { text: 'Books', type: 'category' }
                );
            }

            const relevantSuggestions = smartSuggestions.slice(0, 6);
            showSuggestions(relevantSuggestions, isHeroSearch);
        }

        function showSuggestions(suggestions, isHeroSearch = false) {
            const suggestionsEl = document.getElementById(isHeroSearch ? 'heroSearchSuggestions' : 'searchSuggestions');
            if (!suggestionsEl) return;

            currentSuggestions = suggestions;
            activeSuggestionIndex = -1;

            if (suggestions.length === 0) {
                suggestionsEl.style.display = 'none';
                return;
            }

            suggestionsEl.innerHTML = suggestions.map((suggestion, index) => {
                const icon = suggestion.type === 'loading' ? 'fas fa-spinner fa-spin' :
                           suggestion.type === 'category' ? 'fas fa-th-large' : 'fas fa-search';
                
                return `
                    <div class="suggestion-item" data-index="${index}" onclick="selectSuggestion('${suggestion.text.replace(/'/g, "\\'")}', ${isHeroSearch})">
                        <i class="${icon} suggestion-icon"></i>
                        <span>${suggestion.text}</span>
                    </div>
                `;
            }).join('');

            suggestionsEl.style.display = 'block';
            updateActiveSuggestion(isHeroSearch);
        }

        function hideSuggestions(isHeroSearch = false) {
            const suggestionsEl = document.getElementById(isHeroSearch ? 'heroSearchSuggestions' : 'searchSuggestions');
            if (suggestionsEl) {
                suggestionsEl.style.display = 'none';
            }
            activeSuggestionIndex = -1;
        }

        function updateActiveSuggestion(isHeroSearch = false) {
            const suggestionsEl = document.getElementById(isHeroSearch ? 'heroSearchSuggestions' : 'searchSuggestions');
            if (!suggestionsEl) return;

            const suggestionItems = suggestionsEl.querySelectorAll('.suggestion-item');
            suggestionItems.forEach((item, index) => {
                if (index === activeSuggestionIndex) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function selectSuggestion(text, isHeroSearch = false) {
            const inputEl = document.getElementById(isHeroSearch ? 'heroSearchInput' : 'searchInput');
            if (inputEl) {
                inputEl.value = text;
            }
            hideSuggestions(isHeroSearch);
            performSearch(text);
        }

        function handleSearchKeydown(e) {
            const isHeroSearch = e.target.id === 'heroSearchInput';
            const suggestionsEl = document.getElementById(isHeroSearch ? 'heroSearchSuggestions' : 'searchSuggestions');
            const isVisible = suggestionsEl && suggestionsEl.style.display === 'block';
            
            if (!isVisible || currentSuggestions.length === 0) {
                if (e.key === 'Escape') {
                    hideSuggestions(isHeroSearch);
                }
                return;
            }

            switch (e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    activeSuggestionIndex = Math.min(activeSuggestionIndex + 1, currentSuggestions.length - 1);
                    updateActiveSuggestion(isHeroSearch);
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    activeSuggestionIndex = Math.max(activeSuggestionIndex - 1, -1);
                    updateActiveSuggestion(isHeroSearch);
                    break;
                    
                case 'Enter':
                    e.preventDefault();
                    if (activeSuggestionIndex >= 0 && activeSuggestionIndex < currentSuggestions.length) {
                        selectSuggestion(currentSuggestions[activeSuggestionIndex].text, isHeroSearch);
                    } else {
                        const query = e.target.value.trim();
                        if (query) {
                            hideSuggestions(isHeroSearch);
                            performSearch(query);
                        }
                    }
                    break;
                    
                case 'Escape':
                    hideSuggestions(isHeroSearch);
                    e.target.blur();
                    break;
            }
        }

        function handleSearchSubmit(e) {
            e.preventDefault();
            const form = e.target;
            const input = form.querySelector('.search-input');
            const query = input.value.trim();
            
            if (query) {
                performSearch(query);
            }
        }

        function performSearch(query) {
            window.location.href = `search.html?q=${encodeURIComponent(query)}`;
        }

        // Global data variables
        let categoryImagesData = {};

        // Load data from API
        async function loadDataFromAPI() {
            try {
                console.log('Loading category images from API...');
                
                // Load category images
                const categoryResponse = await fetch('/api/data/category-images');
                if (categoryResponse.ok) {
                    categoryImagesData = await categoryResponse.json();
                    console.log('Loaded category images data');
                } else {
                    console.error('Failed to load category images');
                    categoryImagesData = { categoryImages: {}, defaultFallbacks: {} };
                }

            } catch (error) {
                console.error('Error loading data from API:', error);
                // Fallback to empty objects if API fails
                categoryImagesData = { categoryImages: {}, defaultFallbacks: {} };
            }
        }

        // Load featured products
        async function loadFeaturedProducts() {
            try {
                // Try to load featured products from data API first
                const featuredResponse = await fetch('/api/data/featured-products');
                if (featuredResponse.ok) {
                    const featuredProducts = await featuredResponse.json();
                    console.log('Loaded featured products from data API:', featuredProducts.length);
                    
                    // Transform to match displayFeaturedProducts format
                    const transformedProducts = featuredProducts.map(product => ({
                        id: product.id,
                        name: product.title,
                        rating: product.rating,
                        ratingCount: product.reviewCount,
                        price: product.currentPrice,
                        originalPrice: product.originalPrice,
                        image: product.image
                    }));
                    
                    displayFeaturedProducts(transformedProducts);
                    return;
                }
                
                // Fallback to search API
                const response = await fetch('/api/search?q=featured&limit=8');
                if (!response.ok) {
                    throw new Error('API request failed');
                }
                
                const data = await response.json();
                const results = data.results || data; // Handle both structured and direct response
                
                // Use category images from loaded data
                const categoryImages = categoryImagesData.categoryImages || {};
                const defaultFallbacks = categoryImagesData.defaultFallbacks || {};
                
                // Transform API response to match our product format
                const products = results.map((item, index) => {
                    const category = (item.category || 'electronics').toLowerCase();
                    const categoryImageList = categoryImages[category] || categoryImages['electronics'] || [];
                    const fallbackImage = categoryImageList[index % categoryImageList.length] || 
                                        defaultFallbacks[category] || 
                                        defaultFallbacks['general'] || 
                                        'https://via.placeholder.com/300x200/607D8B/ffffff?text=Product';
                    
                    return {
                        id: item.id || item._id,
                        name: item.title || item.name,
                        rating: item.rating || 4.0,
                        ratingCount: item.reviewCount || Math.floor(Math.random() * 1000) + 100,
                        price: item.currentPrice || item.price || Math.floor(Math.random() * 50000) + 5000,
                        originalPrice: item.originalPrice || (item.currentPrice || item.price ? Math.floor((item.currentPrice || item.price) * 1.2) : Math.floor(Math.random() * 60000) + 10000),
                        image: item.image || fallbackImage
                    };
                });
                
                displayFeaturedProducts(products);
            } catch (error) {
                console.error('Error loading products:', error);
                // Fallback to demo data from API if main API fails
                await loadDemoProductsFromAPI();
            }
        }

        async function loadDemoProductsFromAPI() {
            try {
                const response = await fetch('/api/data/featured-products');
                if (response.ok) {
                    const featuredProducts = await response.json();
                    
                    // Transform to match displayFeaturedProducts format
                    const transformedProducts = featuredProducts.map(product => ({
                        id: product.id,
                        name: product.title,
                        rating: product.rating,
                        ratingCount: product.reviewCount,
                        price: product.currentPrice,
                        originalPrice: product.originalPrice,
                        image: product.image
                    }));
                    
                    displayFeaturedProducts(transformedProducts);
                } else {
                    // Final fallback to hardcoded demo data
                    displayHardcodedDemoProducts();
                }
            } catch (error) {
                console.error('Error loading demo products from API:', error);
                displayHardcodedDemoProducts();
            }
        }

        function displayHardcodedDemoProducts() {
            const demoProducts = [
                {
                    id: 'demo-1',
                    name: 'Apple iPhone 15 (128GB) - Blue',
                    rating: 4.3,
                    ratingCount: 2834,
                    price: 12999,
                    originalPrice: 16999,
                    image: 'https://via.placeholder.com/300x200/007acc/ffffff?text=iPhone+15'
                },
                {
                    id: 'demo-2',
                    name: 'Samsung Galaxy S24 (256GB) - Phantom Black',
                    rating: 4.5,
                    ratingCount: 1876,
                    price: 14999,
                    originalPrice: 18999,
                    image: 'https://via.placeholder.com/300x200/1a1a1a/ffffff?text=Galaxy+S24'
                },
                {
                    id: 'demo-3',
                    name: 'OnePlus 12 5G (128GB) - Flowy Emerald',
                    rating: 4.4,
                    ratingCount: 1245,
                    price: 10999,
                    originalPrice: 13999,
                    image: 'https://via.placeholder.com/300x200/00a040/ffffff?text=OnePlus+12'
                },
                {
                    id: 'demo-4',
                    name: 'Xiaomi Redmi Note 13 Pro (128GB)',
                    rating: 4.2,
                    ratingCount: 3421,
                    price: 5999,
                    originalPrice: 7999,
                    image: 'https://via.placeholder.com/300x200/ff6b35/ffffff?text=Redmi+Note'
                },
                {
                    id: 'demo-5',
                    name: 'Sony WH-1000XM4 Wireless Headphones',
                    rating: 4.6,
                    ratingCount: 2156,
                    price: 7999,
                    originalPrice: 9999,
                    image: 'https://via.placeholder.com/300x200/000000/ffffff?text=Sony+Headphones'
                },
                {
                    id: 'demo-6',
                    name: 'Dell XPS 13 Laptop Intel i7',
                    rating: 4.4,
                    ratingCount: 892,
                    price: 89999,
                    originalPrice: 99999,
                    image: 'https://via.placeholder.com/300x200/0066cc/ffffff?text=Dell+XPS'
                },
                {
                    id: 'demo-7',
                    name: 'Vivo V29 5G (128GB) - Himalayan Blue',
                    rating: 4.1,
                    ratingCount: 654,
                    price: 8999,
                    originalPrice: 11999,
                    image: 'https://via.placeholder.com/300x200/4169e1/ffffff?text=Vivo+V29'
                },
                {
                    id: 'demo-8',
                    name: 'Realme GT 6 5G Mobile Phone',
                    rating: 4.3,
                    ratingCount: 987,
                    price: 7499,
                    originalPrice: 9999,
                    image: 'https://via.placeholder.com/300x200/ffaa00/ffffff?text=Realme+GT6'
                }
            ];

            displayFeaturedProducts(demoProducts);
        }

        function displayFeaturedProducts(products) {
            const container = document.getElementById('featuredProducts');
            if (!container) return;

            container.innerHTML = products.map(product => {
                const discount = Math.floor(((product.originalPrice - product.price) / product.originalPrice) * 100);
                
                return `
                    <div class="product-card">
                        <div class="product-image">
                            <img src="${product.image}" alt="${product.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <i class="fas fa-image" style="display: none;"></i>
                            <div class="wishlist-icon" onclick="toggleWishlist(event, '${product.id}')">
                                <i class="far fa-heart"></i>
                            </div>
                        </div>
                        <a href="product.html?id=${product.id}" class="product-link">
                            <div class="product-name">${product.name}</div>
                            <div class="product-rating">
                                <div class="rating-badge">
                                    <span>${product.rating}</span>
                                    <i class="fas fa-star"></i>
                                </div>
                                <span class="rating-count">(${product.ratingCount})</span>
                            </div>
                            <div class="product-price">
                                <span class="price-current">₹${product.price.toLocaleString()}</span>
                                <span class="price-original">₹${product.originalPrice.toLocaleString()}</span>
                                <span class="price-discount">${discount}% off</span>
                            </div>
                        </a>
                    </div>
                `;
            }).join('');
        }

        // Wishlist functionality
        let wishlistItems = new Set();

        function toggleWishlist(event, productId) {
            event.preventDefault();
            event.stopPropagation();
            
            const wishlistIcon = event.currentTarget;
            const heartIcon = wishlistIcon.querySelector('i');
            
            if (wishlistItems.has(productId)) {
                // Remove from wishlist
                wishlistItems.delete(productId);
                wishlistIcon.classList.remove('liked');
                heartIcon.classList.remove('fas');
                heartIcon.classList.add('far');
            } else {
                // Add to wishlist
                wishlistItems.add(productId);
                wishlistIcon.classList.add('liked');
                heartIcon.classList.remove('far');
                heartIcon.classList.add('fas');
            }
            
            // Optional: Save to localStorage
            localStorage.setItem('wishlistItems', JSON.stringify([...wishlistItems]));
        }

        // Load wishlist from localStorage on page load
        function loadWishlist() {
            const saved = localStorage.getItem('wishlistItems');
            if (saved) {
                wishlistItems = new Set(JSON.parse(saved));
            }
        }

        // Initialize wishlist on page load
        document.addEventListener('DOMContentLoaded', async function() {
            loadWishlist();
            // Update wishlist icons after products are loaded
            setTimeout(() => {
                wishlistItems.forEach(productId => {
                    const wishlistIcon = document.querySelector(`[onclick*="${productId}"]`);
                    if (wishlistIcon) {
                        const heartIcon = wishlistIcon.querySelector('i');
                        wishlistIcon.classList.add('liked');
                        heartIcon.classList.remove('far');
                        heartIcon.classList.add('fas');
                    }
                });
            }, 500); // Increased timeout to allow for async loading
        });
    </script>
</body>
</html>