<!DOCTYPE html>
<html>
<head>
    <title>Test Fixes</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .test { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .result { margin: 10px 0; padding: 5px; background: #f0f0f0; }
    </style>
</head>
<body>
    <h1>Testing Search Fixes</h1>
    
    <div class="test">
        <h3>Test 1: "mob" should suggest mobile phones (not Vero Moda)</h3>
        <button onclick="testMob()">Test "mob" suggestions</button>
        <div id="mobResult" class="result"></div>
    </div>
    
    <div class="test">
        <h3>Test 2: "mobiile" (typo) should suggest mobile phones</h3>
        <button onclick="testMobiile()">Test "mobiile" suggestions</button>
        <div id="mobiileResult" class="result"></div>
    </div>
    
    <div class="test">
        <h3>Test 3: "lapp" should suggest laptops</h3>
        <button onclick="testLapp()">Test "lapp" suggestions</button>
        <div id="lappResult" class="result"></div>
    </div>
    
    <div class="test">
        <h3>Test 4: Enter key should work for direct search</h3>
        <form onsubmit="testEnter(event)">
            <input type="text" placeholder="Type 'laptop' and press Enter" value="laptop">
            <button type="submit">Or click Submit</button>
        </form>
        <div id="enterResult" class="result"></div>
    </div>

    <script>
        async function testMob() {
            try {
                const response = await fetch('/api/suggest?q=mob');
                const data = await response.json();
                const result = document.getElementById('mobResult');
                
                if (data.length > 0) {
                    const first = data[0];
                    result.innerHTML = `✅ First suggestion: "${first.title}" (${first.category}) - Score: ${first.score}`;
                    
                    if (first.category.toLowerCase().includes('smartphone') || 
                        first.category.toLowerCase().includes('mobile') ||
                        first.title.toLowerCase().includes('phone')) {
                        result.style.backgroundColor = '#d4edda';
                        result.innerHTML += '<br><strong>✅ PASS: Mobile device suggested first!</strong>';
                    } else {
                        result.style.backgroundColor = '#f8d7da';
                        result.innerHTML += '<br><strong>❌ FAIL: Non-mobile device suggested first</strong>';
                    }
                } else {
                    result.innerHTML = '❌ No suggestions returned';
                    result.style.backgroundColor = '#f8d7da';
                }
            } catch (error) {
                document.getElementById('mobResult').innerHTML = `❌ Error: ${error.message}`;
            }
        }

        async function testMobiile() {
            try {
                const response = await fetch('/api/suggest?q=mobiile');
                const data = await response.json();
                const result = document.getElementById('mobiileResult');
                
                if (data.length > 0) {
                    const first = data[0];
                    result.innerHTML = `✅ Typo handled: "${first.title}" (${first.category})`;
                    result.style.backgroundColor = '#d4edda';
                } else {
                    result.innerHTML = '❌ Typo not handled';
                    result.style.backgroundColor = '#f8d7da';
                }
            } catch (error) {
                document.getElementById('mobiileResult').innerHTML = `❌ Error: ${error.message}`;
            }
        }

        async function testLapp() {
            try {
                const response = await fetch('/api/suggest?q=lapp');
                const data = await response.json();
                const result = document.getElementById('lappResult');
                
                if (data.length > 0) {
                    const first = data[0];
                    result.innerHTML = `✅ First suggestion: "${first.title}" (${first.category})`;
                    
                    if (first.category.toLowerCase().includes('laptop') || 
                        first.category.toLowerCase().includes('computer') ||
                        first.title.toLowerCase().includes('laptop')) {
                        result.style.backgroundColor = '#d4edda';
                        result.innerHTML += '<br><strong>✅ PASS: Laptop suggested first!</strong>';
                    } else {
                        result.style.backgroundColor = '#f8d7da';
                        result.innerHTML += '<br><strong>❌ FAIL: Non-laptop suggested first</strong>';
                    }
                } else {
                    result.innerHTML = '❌ No suggestions returned';
                    result.style.backgroundColor = '#f8d7da';
                }
            } catch (error) {
                document.getElementById('lappResult').innerHTML = `❌ Error: ${error.message}`;
            }
        }

        function testEnter(event) {
            event.preventDefault();
            const input = event.target.querySelector('input');
            const query = input.value;
            const result = document.getElementById('enterResult');
            
            // Simulate what should happen on Enter - redirect to search page
            result.innerHTML = `✅ Enter key works! Would redirect to: /search.html?q=${encodeURIComponent(query)}`;
            result.style.backgroundColor = '#d4edda';
            
            // Optionally actually redirect (uncomment next line to test)
            // window.location.href = `/search.html?q=${encodeURIComponent(query)}`;
        }

        // Auto-run tests on load
        window.onload = function() {
            setTimeout(testMob, 500);
            setTimeout(testMobiile, 1000);
            setTimeout(testLapp, 1500);
        };
    </script>
</body>
</html>
